<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rainfun.github.io - Vocalost</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    height: 100vh;
    background: #121212;
    color: #fff;
    display: flex;
    justify-content: flex-end;
    align-items: center;
    padding-right: 20px;
    overflow: hidden;
  }
  .chat-container {
    width: 400px;
    height: 700px;
    border-radius: 10px;
    background: #1e1e1e;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
  }
  .messages {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
  }
  .message {
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 8px;
    max-width: 80%;
    background: #333;
    color: #fff;
    font-size: 0.9rem;
    word-wrap: break-word;
    position: relative;
  }
  .message b { color: #fff; }
  .message small { display:block; font-size:0.7rem; color:#fff; margin-top:2px;}
  .reactions { margin-top:4px; display:flex; gap:5px; font-size:1rem; cursor:pointer; }
  .emoji-picker { display:flex; flex-wrap:wrap; padding:5px; background:#2c2c2c; border-top:1px solid #444; max-height:100px; overflow-y:auto; }
  .emoji-picker span { font-size:1.5rem; margin:5px; cursor:pointer; transition:transform 0.1s; }
  .emoji-picker span:hover { transform: scale(1.3); }
  .input-area { display:flex; border-top:1px solid #444; }
  .input-area input { flex:1; padding:10px; border:none; border-radius:0 0 0 10px; outline:none; background:#2c2c2c; color:#fff; }
  .input-area button { padding:10px 15px; border:none; background:#007bff; color:white; border-radius:0 0 10px 0; cursor:pointer; font-weight:bold; }
  .input-area button:hover { background:#0056b3; }
  .nickname-area { display:flex; padding:5px; gap:5px; }
  .nickname-area input { flex:1; padding:5px; border-radius:5px; border:none; outline:none; background:#2c2c2c; color:#fff; }
  .nickname-area button { padding:5px 10px; border-radius:5px; border:none; background:#007bff; color:#fff; cursor:pointer; }
  .nickname-area button:hover { background:#0056b3; }
  .iframe-area { width:100%; height:150px; border:none; margin-top:5px; background:#111; }
  .countdown { text-align:center; margin:5px 0; font-size:1rem; }
  .replying { font-size:0.7rem; color:#ccc; margin-bottom:2px; }
  .entertainment { display:flex; gap:5px; padding:5px; flex-wrap:wrap; }
  .entertainment button { background:#007bff; color:#fff; border:none; padding:5px 8px; border-radius:5px; cursor:pointer; }
  .entertainment button:hover { background:#0056b3; }
</style>
</head>
<body>

<div class="chat-container">

  <div class="nickname-area">
    <input id="nicknameInput" placeholder="Enter nickname...">
    <button id="nicknameBtn">Set Nickname</button>
  </div>

  <div class="messages" id="messages"></div>

  <div class="replying" id="replying"></div>

  <div class="emoji-picker" id="emojiPicker">
    <span>üòÄ</span><span>üòÇ</span><span>üòç</span><span>üòé</span>
    <span>üò¢</span><span>üò°</span><span>üëç</span><span>‚ù§Ô∏è</span>
    <span>üéâ</span><span>üíÄ</span><span>üî•</span>
  </div>

  <div class="input-area">
    <input id="msgInput" type="text" placeholder="Type a message...">
    <button id="sendBtn">Send</button>
  </div>

  <div class="entertainment">
    <button id="randEmoji">Random Emoji</button>
    <button id="miniGame">Mini Game</button>
    <button id="soundBtn">Sound</button>
    <button id="voiceBtn">Voice Chat</button>
  </div>

  <div class="countdown" id="countdown">00:00:00</div>
  <iframe class="iframe-area" src="" id="iframeArea"></iframe>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
import {
  getFirestore, collection, addDoc, onSnapshot, serverTimestamp,
  query, orderBy, doc, updateDoc, arrayUnion
} from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAUSdIAjFmgHJyDs7DPm_wqDfH5gTtgowI",
  authDomain: "anon-chat-7aeb8.firebaseapp.com",
  projectId: "anon-chat-7aeb8",
  storageBucket: "anon-chat-7aeb8.firebasestorage.app",
  messagingSenderId: "893900185108",
  appId: "1:893900185108:web:2c1d3e69adb019f5fa5101",
  measurementId: "G-QWS96HKVH8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let username = "Anon-" + Math.floor(Math.random()*1000);
let replyToId = null;
const cooldown = 5000;
const lastSentKey = "lastSentTime";

const messagesDiv = document.getElementById("messages");
const msgInput = document.getElementById("msgInput");
const sendBtn = document.getElementById("sendBtn");
const emojiPicker = document.getElementById("emojiPicker");
const replyingDiv = document.getElementById("replying");

const nicknameInput = document.getElementById("nicknameInput");
const nicknameBtn = document.getElementById("nicknameBtn");

const randEmojiBtn = document.getElementById("randEmoji");
const miniGameBtn = document.getElementById("miniGame");
const soundBtn = document.getElementById("soundBtn");
const voiceBtn = document.getElementById("voiceBtn");

const countdownEl = document.getElementById("countdown");

// Countdown placeholder
let targetTime = new Date().getTime() + 3600000; // +1 hour
function updateCountdown(){
  let now = new Date().getTime();
  let diff = targetTime - now;
  if(diff<0) diff=0;
  let h = String(Math.floor(diff/3600000)).padStart(2,'0');
  let m = String(Math.floor((diff%3600000)/60000)).padStart(2,'0');
  let s = String(Math.floor((diff%60000)/1000)).padStart(2,'0');
  countdownEl.textContent = `${h}:${m}:${s}`;
}
setInterval(updateCountdown,1000);
updateCountdown();

// Firebase messages
const q = query(collection(db,"messages"),orderBy("timestamp","asc"));
onSnapshot(q,(snapshot)=>{
  messagesDiv.innerHTML="";
  snapshot.forEach(docSnap=>{
    const msg = docSnap.data();
    const div = document.createElement("div");
    div.classList.add("message");

    const replyText = msg.replyToUser ? `<div class="replying">Replying to ${msg.replyToUser}</div>` : "";
    const time = msg.timestamp?.toDate().toLocaleString() || "Just now";
    div.innerHTML = `${replyText}<b>${msg.user}:</b> ${msg.text} <small>${time}</small>`;

    const reactionsDiv = document.createElement("div");
    reactionsDiv.classList.add("reactions");
    const emojis = ["üòÄ","üòÇ","üòç","üòé","üò¢","üò°","üëç","‚ù§Ô∏è","üéâ","üíÄ","üî•"];
    emojis.forEach(e=>{
      const span = document.createElement("span");
      span.textContent = e + (msg.reactions?.[e]?.length||"");
      span.addEventListener("click", async ()=>{
        const msgRef = doc(db,"messages",docSnap.id);
        await updateDoc(msgRef,{[`reactions.${e}`]: arrayUnion(username)});
      });
      reactionsDiv.appendChild(span);
    });

    // Reply button
    const replyBtn = document.createElement("button");
    replyBtn.textContent="Reply";
    replyBtn.style.marginLeft="5px";
    replyBtn.style.background="#444";
    replyBtn.style.color="#fff";
    replyBtn.style.border="none";
    replyBtn.style.borderRadius="5px";
    replyBtn.style.cursor="pointer";
    replyBtn.addEventListener("click",()=> {
      replyToId = docSnap.id;
      replyingDiv.textContent = "Replying to "+msg.user;
      msgInput.focus();
    });
    div.appendChild(replyBtn);

    div.appendChild(reactionsDiv);
    messagesDiv.appendChild(div);
  });
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});

// Send message with cooldown
sendBtn.addEventListener("click",async()=>{
  const now = Date.now();
  const lastSent = parseInt(localStorage.getItem(lastSentKey)) || 0;
  if(now-lastSent<cooldown){
    alert("Please wait a few seconds before sending another message.");
    return;
  }
  if(msgInput.value.trim()!==""){
    const data = {
      user: username,
      text: msgInput.value,
      timestamp: serverTimestamp(),
      reactions:{}
    };
    if(replyToId) data.replyTo = replyToId;
    if(replyToId) {
      const replyDoc = await doc(db,"messages",replyToId).get();
      data.replyToUser = ""; // optional
    }
    await addDoc(collection(db,"messages"),data);
    msgInput.value="";
    localStorage.setItem(lastSentKey,now);
    replyToId=null;
    replyingDiv.textContent="";
  }
});
msgInput.addEventListener("keypress",e=>{if(e.key==="Enter") sendBtn.click();});

// Emoji picker
emojiPicker.querySelectorAll("span").forEach(emoji=>{
  emoji.addEventListener("click",()=>{msgInput.value+=emoji.textContent; msgInput.focus();});
});

// Nickname
nicknameBtn.addEventListener("click",()=>{if(nicknameInput.value.trim()!=="") username=nicknameInput.value; nicknameInput.value="";});

// Entertainment buttons
randEmojiBtn.addEventListener("click",()=>{msgInput.value+=["üòÄ","üòÇ","üòç","üòé","üò¢","üò°","üëç","‚ù§Ô∏è","üéâ","üíÄ","üî•"][Math.floor(Math.random()*12)]; msgInput.focus();});
miniGameBtn.addEventListener("click",()=>{alert("Mini Game Placeholder!");});
soundBtn.addEventListener("click",()=>{new Audio("https://www.soundjay.com/button/beep-07.wav").play();});
voiceBtn.addEventListener("click",()=>{alert("Voice Chat Placeholder! Requires WebRTC implementation.");});
</script>

</body>
</html>
